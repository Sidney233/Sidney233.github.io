<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Centos7安装配置Mariadb</title>
      <link href="/posts/40278/"/>
      <url>/posts/40278/</url>
      
        <content type="html"><![CDATA[<h1 id="Centos7安装配置Mariadb"><a href="#Centos7安装配置Mariadb" class="headerlink" title="Centos7安装配置Mariadb"></a>Centos7安装配置Mariadb</h1><p>因为之前用的 MariaDB 服务器还装了 GitLab，服务器卡顿严重，现在重新在一台空闲服务器上重新装一个MariaDB。</p><h2 id="配置-yum-repo"><a href="#配置-yum-repo" class="headerlink" title="配置 yum repo"></a>配置 yum repo</h2><p>生产环境装的 MariaDB 是10.3.x，首先去 <a href="https://mariadb.org/download">MariaDB 官网</a>看一下目前的稳定版本</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171608141.png" alt="image-20250517160857080"></p><p>可以看到最接近的是10.5.29，将下面选项卡切换到 <strong>MariaDB Server Repositories</strong>，然后选择系统发行版本和所需要的 MariaDB 版本</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171611433.png" alt="image-20250517161154365"></p><p>最后镜像选择清华大学的。根据官网提示，我们需要去系统的 repo 目录中配置一个 MariaDB.repo。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MariaDB 10.5 RedHatEnterpriseLinux repository list - created 2025-05-17 08:10 UTC</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">https://mariadb.org/download/</span></span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rpm.mariadb.org is a dynamic mirror <span class="keyword">if</span> your preferred mirror goes offline. See https://mariadb.org/mirrorbits/ <span class="keyword">for</span> details.</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">baseurl = https://rpm.mariadb.org/10.5/rhel/<span class="variable">$releasever</span>/<span class="variable">$basearch</span></span></span><br><span class="line">baseurl = https://mirrors.tuna.tsinghua.edu.cn/mariadb/yum/10.5/rhel/$releasever/$basearch</span><br><span class="line">module_hotfixes = 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">gpgkey = https://rpm.mariadb.org/RPM-GPG-KEY-MariaDB</span></span><br><span class="line">gpgkey = https://mirrors.tuna.tsinghua.edu.cn/mariadb/yum/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck = 1</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将上述配置文件新建在目录中即可</p><h2 id="下载安装-MariaDB"><a href="#下载安装-MariaDB" class="headerlink" title="下载安装 MariaDB"></a>下载安装 MariaDB</h2><p>配置完成后按照官网提示安装</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171641057.png" alt="image-20250517164132984"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install MariaDB-server MariaDB-client</span><br></pre></td></tr></table></figure><p>如果网络正常的话这里几分钟就能安装成功</p><p>最后输入命令启动 MariaDB 并且设置自动启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mariadb # 启动</span><br><span class="line">systemctl enable mariadb # 设置开机启动</span><br></pre></td></tr></table></figure><h2 id="配置-MariaDB"><a href="#配置-MariaDB" class="headerlink" title="配置 MariaDB"></a>配置 MariaDB</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql_secure_installation</span><br></pre></td></tr></table></figure><p>使用上述命令进入 MariaDB &#x2F; MySQL 的配置界面</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Enter current password for root (enter for none):</span><br></pre></td></tr></table></figure><p>会提示输入密码，这里直接按回车，因为初始密码为空</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Setting the root password or using the unix_socket ensures that nobody</span><br><span class="line">can log into the MariaDB root user without the proper authorisation.</span><br><span class="line"></span><br><span class="line">You already have your root account protected, so you can safely answer &#x27;n&#x27;.</span><br><span class="line"></span><br><span class="line">Switch to unix_socket authentication [Y/n] </span><br></pre></td></tr></table></figure><p>输入密码后会提示是否设置 unix_socket 连接，这里选择 n，因为是测试环境，需要能够远程用root账户连接，如果是生产环境，建议选择 Y，这样 root 只能在服务器本地登录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">You already have your root account protected, so you can safely answer &#x27;n&#x27;.</span><br><span class="line"></span><br><span class="line">Change the root password? [Y/n] </span><br></pre></td></tr></table></figure><p>选择 Y 修改 root 密码</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">By default, a MariaDB installation has an anonymous user, allowing anyone</span><br><span class="line">to log into MariaDB without having to have a user account created for</span><br><span class="line">them.  This is intended only for testing, and to make the installation</span><br><span class="line">go a bit smoother.  You should remove them before moving into a</span><br><span class="line">production environment.</span><br><span class="line"></span><br><span class="line">Remove anonymous users? [Y/n] </span><br></pre></td></tr></table></figure><p>删除匿名用户，根据提示，匿名用户可以直接连接 MariaDB，比较危险，这里选择 Y</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Normally, root should only be allowed to connect from &#x27;localhost&#x27;.  This</span><br><span class="line">ensures that someone cannot guess at the root password from the network.</span><br><span class="line"></span><br><span class="line">Disallow root login remotely? [Y/n] </span><br></pre></td></tr></table></figure><p>选择 Y 以开启 root 远程连接</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">By default, MariaDB comes with a database named &#x27;test&#x27; that anyone can</span><br><span class="line">access.  This is also intended only for testing, and should be removed</span><br><span class="line">before moving into a production environment.</span><br><span class="line"></span><br><span class="line">Remove test database and access to it? [Y/n] </span><br></pre></td></tr></table></figure><p>选择 Y 删除所有人都可访问的 test 数据库</p><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Reloading the privilege tables will ensure that all changes made so far</span><br><span class="line">will take effect immediately.</span><br><span class="line"></span><br><span class="line">Reload privilege tables now? [Y/n] </span><br></pre></td></tr></table></figure><p>选择 Y 使目前所有的设置都生效，否则需要手动重启</p><p>现在都已经设置完毕，我们进入 MariaDB 查看是否成功</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure><p>如果能够输入密码并且进入数据库则说明配置成功</p><h2 id="配置远程连接"><a href="#配置远程连接" class="headerlink" title="配置远程连接"></a>配置远程连接</h2><p>现在需要修改 MariaDB 的配置文件和 root 的允许访问的 IP 地址来实现远程连接。为了安全，MariaDB 默认是只能 127.0.0.1 访问（但是我所使用的这个版本使用上面初始化配置之后不需要配置 bind-address 就能远程连接，以防万一还是设置一下），需要修改为 0.0.0.0 来让内网中所有 IP 都能访问</p><h3 id="修改-MariaDB-配置文件"><a href="#修改-MariaDB-配置文件" class="headerlink" title="修改 MariaDB 配置文件"></a>修改 MariaDB 配置文件</h3><p>MariaDB 的默认配置文件在 <code>/etc/my.cnf</code>中</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171814882.png" alt="image-20250517181423811"></p><p>可以看到只有两行配置，显示其他配置在 <code>/etc/my.cnf.d</code> 中</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171908972.png" alt="image-20250517190819913"></p><p>我们这里需要对 <code>server.cnf</code> 进行修改</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171914519.png" alt="image-20250517191400412"></p><p>可以看到这里的注释已经说明了，如果要允许所有 IP 地址的访问，取消注释 <code>bind-address=0.0.0.0</code> 这一行</p><p>重启 MariaDB</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb</span><br></pre></td></tr></table></figure><p>查看 MariaDB 状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mariadb</span><br></pre></td></tr></table></figure><p>可以看到已经成功启动，并且地址为 <code>0.0.0.0:3306</code></p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171921561.png" alt="image-20250517192115449"></p><h3 id="修改-root-用户允许访问的-IP-地址"><a href="#修改-root-用户允许访问的-IP-地址" class="headerlink" title="修改 root 用户允许访问的 IP 地址"></a>修改 root 用户允许访问的 IP 地址</h3><p>进入数据库，输入以下查询语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">select</span> host, <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505181113960.png" alt="image-20250518111358910"></p><p>可以看到 root 用户的允许访问的 Host 仍为 localhost，这意味着只能在服务器本地登录进入 MariaDB 数据库</p><p>我们可以对这个字段进行修改</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">USER</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> <span class="keyword">TO</span> <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br></pre></td></tr></table></figure><p>再次查询就能看到 root 的 Host 被修改为 % ，意味着任意 IP 都能进行访问，如果是生产环境，这里的 % 建议修改为后端服务器的 IP 地址，这样就能拦截掉其他 IP 的访问</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505181121458.png" alt="image-20250518112055346"></p><h3 id="开放防火墙端口"><a href="#开放防火墙端口" class="headerlink" title="开放防火墙端口"></a>开放防火墙端口</h3><p>到这一步还是不能访问，因为防火墙的 3306 端口还没开放，所有的请求都会被拦截</p><p>首先使用 <code> firewall-cmd --state</code> 查看防火墙状态，如果未开启则不需要配置</p><p>如果防火墙开启，则需要输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3306/tcp --permanent # 打开3306端口</span><br><span class="line">firewall-cmd --reload # 重新载入配置文件</span><br></pre></td></tr></table></figure><p>成功之后就能实现远程连接</p><h2 id="使用-Navicat-远程连接"><a href="#使用-Navicat-远程连接" class="headerlink" title="使用 Navicat 远程连接"></a>使用 Navicat 远程连接</h2><p>配置完成之后，为了方便我们在本地操作，可以使用 Navicat 配置远程连接，可以在图形化界面对数据库进行操作</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171929900.png" alt="image-20250517192951816"></p><p>点击连接，进入配置界面</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171930973.png" alt="image-20250517193025841"></p><p>选择 MariaDB</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505171931771.png" alt="image-20250517193122661"></p><p>按照实际情况填写即可</p><p>填完之后可以点击左下角的测试连接，检查是否联通</p><p>如果能联通就直接下一步，这样 Navicat 就会保存账号密码，以后每次都能直接连接</p><p><img src="https://cdn.jsdelivr.net/gh/Sidney233/PicBed@main/img/202505181123750.png" alt="image-20250518112322655"></p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> Linux </tag>
            
            <tag> Centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Web期末项目——对期中项目的改进</title>
      <link href="/posts/1efa055b/"/>
      <url>/posts/1efa055b/</url>
      
        <content type="html"><![CDATA[<p>对老师给的代码进行了修改</p><span id="more"></span><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本次作业是对期中搭的简易网站的改进与丰富，具体添加的功能会在下面展示。</p><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>在正式开始之前，先在我们之前的crawl数据库中建立用户信息表和用户操作记录表，SQL语句如下</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建用户信息数据表</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `crawl`.`<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">VARCHAR</span>(<span class="number">45</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `password` <span class="type">VARCHAR</span>(<span class="number">45</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `registertime` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `valid` <span class="type">BOOLEAN</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `username_UNIQUE` (`username`))</span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--记录用户的登陆，查询（具体查询语句）操作</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> `crawl`.`user_action` (</span><br><span class="line">  `id` <span class="type">INT</span> UNSIGNED <span class="keyword">NOT NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">VARCHAR</span>(<span class="number">45</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `request_time` <span class="type">VARCHAR</span>(<span class="number">45</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `request_method` <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `request_url` <span class="type">VARCHAR</span>(<span class="number">300</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">4</span>),</span><br><span class="line">  `remote_addr` <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (`id`))</span><br><span class="line">ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure><p>其中valid字段说明该用户是否可用，因为我们添加了停用用户账号功能。</p><h2 id="登录、注册界面"><a href="#登录、注册界面" class="headerlink" title="登录、注册界面"></a>登录、注册界面</h2><p><img src="https://i.loli.net/2021/06/30/FuJUDqICy3oxvHO.png" alt="Snipaste_2021-06-30_15-48-45.png"></p><p><img src="https://i.loli.net/2021/06/30/dRaHg41wXJF68hG.png" alt="Snipaste_2021-06-30_15-49-16.png"> </p><p>可以通过导航栏的Login按钮与Register按钮进行切换，实现代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#login-form-link&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#login-form&quot;</span>).<span class="title function_">delay</span>(<span class="number">100</span>).<span class="title function_">fadeIn</span>(<span class="number">100</span>);</span><br><span class="line">        $(<span class="string">&quot;#register-form&quot;</span>).<span class="title function_">fadeOut</span>(<span class="number">100</span>);</span><br><span class="line">        $(<span class="string">&#x27;#register-form-link&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">        e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">&#x27;#register-form-link&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;</span><br><span class="line">        $(<span class="string">&quot;#register-form&quot;</span>).<span class="title function_">delay</span>(<span class="number">100</span>).<span class="title function_">fadeIn</span>(<span class="number">100</span>);</span><br><span class="line">        $(<span class="string">&quot;#login-form&quot;</span>).<span class="title function_">fadeOut</span>(<span class="number">100</span>);</span><br><span class="line">        $(<span class="string">&#x27;#login-form-link&#x27;</span>).<span class="title function_">removeClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">        $(<span class="variable language_">this</span>).<span class="title function_">addClass</span>(<span class="string">&#x27;active&#x27;</span>);</span><br><span class="line">        e.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>对html中的标签进行操作，从而做到了不需要切换网页就实现登录和注册两个表单。</p><p>用户的操作记录会被打印在终端并保存在数据库中</p><p><img src="https://i.loli.net/2021/06/30/klbaoU6RJC9fMKZ.png" alt="Snipaste_2021-06-30_16-04-10.png"></p><p><img src="https://i.loli.net/2021/06/30/XLTy247FRvJSWGA.png" alt="Snipaste_2021-06-30_16-04-20.png"></p><p>这里使用的express的中间件来实现</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="title function_">logger</span>(<span class="keyword">function</span> (<span class="params">tokens, req, res</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;打印的日志信息：&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> request_time = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> request_method = tokens.<span class="title function_">method</span>(req, res);</span><br><span class="line">  <span class="keyword">var</span> request_url = tokens.<span class="title function_">url</span>(req, res);</span><br><span class="line">  <span class="keyword">var</span> status = tokens.<span class="title function_">status</span>(req, res);</span><br><span class="line">  <span class="keyword">var</span> remote_addr = tokens[<span class="string">&#x27;remote-addr&#x27;</span>](req, res);</span><br><span class="line">  <span class="keyword">if</span>(req.<span class="property">session</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> username = req.<span class="property">session</span>[<span class="string">&#x27;username&#x27;</span>]||<span class="string">&#x27;notlogin&#x27;</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> username = <span class="string">&#x27;notlogin&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 直接将用户操作记入mysql中</span></span><br><span class="line">  <span class="keyword">if</span>(username!=<span class="string">&#x27;notlogin&#x27;</span>)&#123;</span><br><span class="line">    logDAO.<span class="title function_">userlog</span>([username,request_time,request_method,request_url,status,remote_addr], <span class="keyword">function</span> (<span class="params">success</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功保存！&#x27;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求时间  = &#x27;</span>, request_time);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求方式  = &#x27;</span>, request_method);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求链接  = &#x27;</span>, request_url);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求状态  = &#x27;</span>, status);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;请求长度  = &#x27;</span>, tokens.<span class="title function_">res</span>(req, res, <span class="string">&#x27;content-length&#x27;</span>),);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;响应时间  = &#x27;</span>, tokens[<span class="string">&#x27;response-time&#x27;</span>](req, res) + <span class="string">&#x27;ms&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;远程地址  = &#x27;</span>, remote_addr);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;远程用户  = &#x27;</span>, tokens[<span class="string">&#x27;remote-user&#x27;</span>](req, res));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;http版本  = &#x27;</span>, tokens[<span class="string">&#x27;http-version&#x27;</span>](req, res));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;浏览器信息 = &#x27;</span>, tokens[<span class="string">&#x27;user-agent&#x27;</span>](req, res));</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;用户 = &#x27;</span>, username);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27; ===============&#x27;</span>,method);</span><br><span class="line"></span><br><span class="line">&#125;, ));</span><br></pre></td></tr></table></figure><h2 id="查看数据"><a href="#查看数据" class="headerlink" title="查看数据"></a>查看数据</h2><p>注册登录后，可以进入网站查看爬取到的新闻，并且可以按照时间升序降序展示</p><p><img src="https://i.loli.net/2021/06/30/NyrSdRK32bkJIsH.png" alt="Snipaste_2021-06-30_16-06-58.png"></p><p><img src="https://i.loli.net/2021/06/30/mctJldZ3NrzvXak.png" alt="Snipaste_2021-06-30_16-07-29.png"></p><p>代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/search&#x27;</span>, <span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(request.<span class="property">session</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">    <span class="comment">//sql字符串和参数</span></span><br><span class="line">    <span class="keyword">if</span> (request.<span class="property">session</span>[<span class="string">&#x27;username&#x27;</span>]===<span class="literal">undefined</span>) &#123;</span><br><span class="line">        <span class="comment">// response.redirect(&#x27;/index.html&#x27;)</span></span><br><span class="line">        response.<span class="title function_">json</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;url&#x27;</span>,<span class="attr">result</span>:<span class="string">&#x27;/index.html&#x27;</span>&#125;);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> param = request.<span class="property">query</span>;</span><br><span class="line">        newsDAO.<span class="title function_">search</span>(param,<span class="keyword">function</span> (<span class="params">err, result, fields</span>) &#123;</span><br><span class="line">            response.<span class="title function_">json</span>(&#123;<span class="attr">message</span>:<span class="string">&#x27;data&#x27;</span>,<span class="attr">result</span>:result&#125;);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 分页</span></span><br><span class="line"> $scope.<span class="property">initPageSort</span>=<span class="keyword">function</span>(<span class="params">item</span>)&#123;</span><br><span class="line">     $scope.<span class="property">data</span> = item;</span><br><span class="line">     $scope.<span class="property">pageSize</span>=<span class="number">8</span>;　　<span class="comment">//每页显示的数据量，可以随意更改</span></span><br><span class="line">     $scope.<span class="property">selPage</span> = <span class="number">1</span>;</span><br><span class="line">     $scope.<span class="property">pages</span> = <span class="title class_">Math</span>.<span class="title function_">ceil</span>($scope.<span class="property">data</span>.<span class="property">length</span> / $scope.<span class="property">pageSize</span>); <span class="comment">//分页数</span></span><br><span class="line">     $scope.<span class="property">pageList</span> = [];<span class="comment">//最多显示5页，后面6页之后不会全部列出页码来</span></span><br><span class="line">     $scope.<span class="property">index</span> = <span class="number">1</span>;</span><br><span class="line">     <span class="comment">// var page = 1;</span></span><br><span class="line">     <span class="comment">// for (var i = page; i &lt; $scope.pages+1 &amp;&amp; i &lt; page+5; i++) &#123;</span></span><br><span class="line">     <span class="comment">//     $scope.pageList.push(i);</span></span><br><span class="line">     <span class="comment">// &#125;</span></span><br><span class="line">     <span class="keyword">var</span> len = $scope.<span class="property">pages</span>&gt; <span class="number">5</span> ? <span class="number">5</span>:$scope.<span class="property">pages</span>;</span><br><span class="line">     $scope.<span class="property">pageList</span> = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123;<span class="attr">length</span>: len&#125;, <span class="function">(<span class="params">x,i</span>) =&gt;</span> i+<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//设置表格数据源(分页)</span></span><br><span class="line">     $scope.<span class="property">items</span> = $scope.<span class="property">data</span>.<span class="title function_">slice</span>(<span class="number">0</span>, $scope.<span class="property">pageSize</span>);</span><br><span class="line"></span><br><span class="line"> &#125;;</span><br><span class="line">$scope.<span class="property">selectPage</span> = <span class="keyword">function</span> (<span class="params">page</span>) &#123;</span><br><span class="line">     <span class="comment">//不能小于1大于最大（第一页不会有前一页，最后一页不会有后一页）</span></span><br><span class="line">     <span class="keyword">if</span> (page &lt; <span class="number">1</span> || page &gt; $scope.<span class="property">pages</span>) <span class="keyword">return</span>;</span><br><span class="line">     <span class="comment">//最多显示分页数5，开始分页转换</span></span><br><span class="line">     <span class="keyword">var</span> pageList = [];</span><br><span class="line">     <span class="keyword">if</span>(page&gt;<span class="number">2</span>)&#123;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">var</span> i = page-<span class="number">2</span>; i &lt;= $scope.<span class="property">pages</span> &amp;&amp; i &lt; page+<span class="number">3</span>; i++) &#123;</span><br><span class="line">             pageList.<span class="title function_">push</span>(i);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">var</span> i = page; i &lt;= $scope.<span class="property">pages</span> &amp;&amp; i &lt; page+<span class="number">5</span>; i++) &#123;</span><br><span class="line">             pageList.<span class="title function_">push</span>(i);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     $scope.<span class="property">index</span> =(page-<span class="number">1</span>)*$scope.<span class="property">pageSize</span>+<span class="number">1</span>;</span><br><span class="line">     $scope.<span class="property">pageList</span> = pageList;</span><br><span class="line">     $scope.<span class="property">selPage</span> = page;</span><br><span class="line">     $scope.<span class="property">items</span> = $scope.<span class="property">data</span>.<span class="title function_">slice</span>(($scope.<span class="property">pageSize</span> * (page - <span class="number">1</span>)), (page * $scope.<span class="property">pageSize</span>));<span class="comment">//通过当前页数筛选出表格当前显示数据</span></span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;选择的页：&quot;</span> + page);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure><p>在图片方面，可以查看新闻发布时间的柱状图，某个关键词在新闻中出现频率的折线图和发布单位的状图，还使用中文分词构造了一个词云用于展示</p><p><img src="https://i.loli.net/2021/06/30/GLSwUsChtx8NPFT.png" alt="Snipaste_2021-06-30_16-14-14.png"><br><img src="https://i.loli.net/2021/06/30/gYp6bN9JDnEh7PG.png" alt="Snipaste_2021-06-30_16-14-59.png"><br><img src="https://i.loli.net/2021/06/30/4hxQ6bNu2tKLkyR.png" alt="Snipaste_2021-06-30_16-14-40.png"></p><p><img src="https://i.loli.net/2021/06/30/DmSOViTLjZlnNEP.png" alt="Snipaste_2021-06-30_16-14-30.png"></p><p>最后这个饼图由于爬取数据的原因，所以展示得有点问题。</p><p>主要是前端的js代码，实现如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面是四个图的操作</span></span><br><span class="line">$scope.<span class="property">histogram</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $scope.<span class="property">searchng</span> = <span class="literal">false</span>;</span><br><span class="line">    $scope.<span class="property">displayng</span> = <span class="literal">false</span>;</span><br><span class="line">    $scope.<span class="property">pictureng</span> = <span class="literal">true</span>;</span><br><span class="line">    $http.<span class="title function_">get</span>(<span class="string">&quot;/news/histogram&quot;</span>)</span><br><span class="line">        .<span class="title function_">then</span>(</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">message</span>==<span class="string">&#x27;url&#x27;</span>)&#123;</span><br><span class="line">                    <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=res.<span class="property">data</span>.<span class="property">result</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// var newdata = washdata(data);</span></span><br><span class="line">                    <span class="keyword">let</span> xdata = [], ydata = [], newdata;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> pattern = <span class="regexp">/\d&#123;4&#125;-(\d&#123;2&#125;-\d&#123;2&#125;)/</span>;</span><br><span class="line">                    res.<span class="property">data</span>.<span class="property">result</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element</span>) &#123;</span><br><span class="line">                        <span class="comment">// &quot;x&quot;:&quot;2020-04-28T16:00:00.000Z&quot; ,对x进行处理,只取 月日</span></span><br><span class="line">                        xdata.<span class="title function_">push</span>(pattern.<span class="title function_">exec</span>(element[<span class="string">&quot;x&quot;</span>])[<span class="number">1</span>]);</span><br><span class="line">                        ydata.<span class="title function_">push</span>(element[<span class="string">&quot;y&quot;</span>]);</span><br><span class="line">                    &#125;);</span><br><span class="line">                    newdata = &#123;<span class="string">&quot;xdata&quot;</span>: xdata, <span class="string">&quot;ydata&quot;</span>: ydata&#125;;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main1&#x27;</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 指定图表的配置项和数据</span></span><br><span class="line">                    <span class="keyword">var</span> option = &#123;</span><br><span class="line">                        <span class="attr">title</span>: &#123;</span><br><span class="line">                            <span class="attr">text</span>: <span class="string">&#x27;新闻发布数 随时间变化&#x27;</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">tooltip</span>: &#123;&#125;,</span><br><span class="line">                        <span class="attr">legend</span>: &#123;</span><br><span class="line">                            <span class="attr">data</span>: [<span class="string">&#x27;新闻发布数&#x27;</span>]</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">dataZoom</span>: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;inside&#x27;</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        ],</span><br><span class="line"></span><br><span class="line">                        <span class="attr">xAxis</span>: &#123;</span><br><span class="line">                            <span class="attr">data</span>: newdata[<span class="string">&quot;xdata&quot;</span>],</span><br><span class="line">                            <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                                <span class="attr">inside</span>: <span class="literal">true</span>,</span><br><span class="line">                                <span class="attr">textStyle</span>: &#123;</span><br><span class="line">                                    <span class="attr">color</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">axisTick</span>: &#123;</span><br><span class="line">                                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">axisLine</span>: &#123;</span><br><span class="line">                                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">z</span>: <span class="number">10</span></span><br><span class="line">                        &#125;,</span><br><span class="line"></span><br><span class="line">                        <span class="attr">yAxis</span>: &#123;</span><br><span class="line">                            <span class="attr">axisLine</span>: &#123;</span><br><span class="line">                                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">axisTick</span>: &#123;</span><br><span class="line">                                <span class="attr">show</span>: <span class="literal">false</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">axisLabel</span>: &#123;</span><br><span class="line">                                <span class="attr">textStyle</span>: &#123;</span><br><span class="line">                                    <span class="attr">color</span>: <span class="string">&#x27;#999&#x27;</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">series</span>: [&#123;</span><br><span class="line">                            <span class="attr">name</span>: <span class="string">&#x27;新闻数目&#x27;</span>,</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span><br><span class="line">                            <span class="attr">data</span>: newdata[<span class="string">&quot;ydata&quot;</span>],</span><br><span class="line">                            <span class="attr">showBackground</span>: <span class="literal">true</span>,</span><br><span class="line">                            <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                                <span class="attr">color</span>: <span class="keyword">new</span> echarts.<span class="property">graphic</span>.<span class="title class_">LinearGradient</span>(</span><br><span class="line">                                    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">                                    [</span><br><span class="line">                                        &#123;<span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;#83bff6&#x27;</span>&#125;,</span><br><span class="line">                                        &#123;<span class="attr">offset</span>: <span class="number">0.5</span>, <span class="attr">color</span>: <span class="string">&#x27;#188df0&#x27;</span>&#125;,</span><br><span class="line">                                        &#123;<span class="attr">offset</span>: <span class="number">1</span>, <span class="attr">color</span>: <span class="string">&#x27;#188df0&#x27;</span>&#125;</span><br><span class="line">                                    ]</span><br><span class="line">                                )</span><br><span class="line">                            &#125;,</span><br><span class="line">                            <span class="attr">emphasis</span>: &#123;</span><br><span class="line">                                <span class="attr">itemStyle</span>: &#123;</span><br><span class="line">                                    <span class="attr">color</span>: <span class="keyword">new</span> echarts.<span class="property">graphic</span>.<span class="title class_">LinearGradient</span>(</span><br><span class="line">                                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">                                        [</span><br><span class="line">                                            &#123;<span class="attr">offset</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="string">&#x27;#2378f7&#x27;</span>&#125;,</span><br><span class="line">                                            &#123;<span class="attr">offset</span>: <span class="number">0.7</span>, <span class="attr">color</span>: <span class="string">&#x27;#2378f7&#x27;</span>&#125;,</span><br><span class="line">                                            &#123;<span class="attr">offset</span>: <span class="number">1</span>, <span class="attr">color</span>: <span class="string">&#x27;#83bff6&#x27;</span>&#125;</span><br><span class="line">                                        ]</span><br><span class="line">                                    )</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;,</span><br><span class="line">                        &#125;]</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="comment">// 使用刚指定的配置项和数据显示图表。</span></span><br><span class="line">                    myChart.<span class="title function_">setOption</span>(option);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">                $scope.<span class="property">msg</span> = err.<span class="property">data</span>;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">$scope.<span class="property">pie</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $scope.<span class="property">searchng</span> = <span class="literal">false</span>;</span><br><span class="line">    $scope.<span class="property">displayng</span> = <span class="literal">false</span>;</span><br><span class="line">    $scope.<span class="property">pictureng</span> = <span class="literal">true</span>;</span><br><span class="line">    $http.<span class="title function_">get</span>(<span class="string">&quot;/news/pie&quot;</span>).<span class="title function_">then</span>(</span><br><span class="line">        <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(res.<span class="property">data</span>.<span class="property">message</span>==<span class="string">&#x27;url&#x27;</span>)&#123;</span><br><span class="line">                <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span>=res.<span class="property">data</span>.<span class="property">result</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> newdata = [];</span><br><span class="line">                <span class="keyword">let</span> selected = &#123;&#125;;</span><br><span class="line">                <span class="keyword">let</span> i=<span class="number">0</span>;</span><br><span class="line">                res.<span class="property">data</span>.<span class="property">result</span>.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">element</span>) &#123;</span><br><span class="line">                    newdata.<span class="title function_">push</span>(&#123;<span class="attr">name</span>: element[<span class="string">&quot;x&quot;</span>], <span class="attr">value</span>: element[<span class="string">&quot;y&quot;</span>]&#125;);</span><br><span class="line">                    selected[element[<span class="string">&quot;x&quot;</span>]]=i++<span class="language-xml">&lt;6;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                &#125;);</span></span><br><span class="line"><span class="language-xml">                newdata=newdata.filter(item=&gt;&#123;return item.value!=0&#125;)</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                var myChart = echarts.init(document.getElementById(&#x27;main1&#x27;));</span></span><br><span class="line"><span class="language-xml">                var app = &#123;&#125;;</span></span><br><span class="line"><span class="language-xml">                option = null;</span></span><br><span class="line"><span class="language-xml">                // 指定图表的配置项和数据</span></span><br><span class="line"><span class="language-xml">                var option = &#123;</span></span><br><span class="line"><span class="language-xml">                    title: &#123;</span></span><br><span class="line"><span class="language-xml">                        text: &#x27;作者/单位发布新闻数量&#x27;,</span></span><br><span class="line"><span class="language-xml">                        x: &#x27;center&#x27;</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    tooltip: &#123;</span></span><br><span class="line"><span class="language-xml">                        trigger: &#x27;item&#x27;,</span></span><br><span class="line"><span class="language-xml">                        formatter: &quot;&#123;a&#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span>&#123;b&#125; : &#123;c&#125; (&#123;d&#125;%)&quot;</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    legend: &#123;</span></span><br><span class="line"><span class="language-xml">                        type:&#x27;scroll&#x27;,</span></span><br><span class="line"><span class="language-xml">                        orient: &#x27;vertical&#x27;,</span></span><br><span class="line"><span class="language-xml">                        right:10,</span></span><br><span class="line"><span class="language-xml">                        top:20,</span></span><br><span class="line"><span class="language-xml">                        bottom:20,</span></span><br><span class="line"><span class="language-xml">                        selected:selected</span></span><br><span class="line"><span class="language-xml">                        // data: [&#x27;直接访问&#x27;, &#x27;邮件营销&#x27;, &#x27;联盟广告&#x27;, &#x27;视频广告&#x27;, &#x27;搜索引擎&#x27;]</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    series: [</span></span><br><span class="line"><span class="language-xml">                        &#123;</span></span><br><span class="line"><span class="language-xml">                            name: &#x27;访问来源&#x27;,</span></span><br><span class="line"><span class="language-xml">                            type: &#x27;pie&#x27;,</span></span><br><span class="line"><span class="language-xml">                            radius: [&#x27;40%&#x27;, &#x27;75%&#x27;],</span></span><br><span class="line"><span class="language-xml">                            center: [&#x27;50%&#x27;, &#x27;50%&#x27;],</span></span><br><span class="line"><span class="language-xml">                            data: newdata,</span></span><br><span class="line"><span class="language-xml">                            itemStyle: &#123;</span></span><br><span class="line"><span class="language-xml">                                emphasis: &#123;</span></span><br><span class="line"><span class="language-xml">                                    shadowBlur: 10,</span></span><br><span class="line"><span class="language-xml">                                    shadowOffsetX: 0,</span></span><br><span class="line"><span class="language-xml">                                    shadowColor: &#x27;rgba(0, 0, 0, 0.5)&#x27;</span></span><br><span class="line"><span class="language-xml">                                &#125;</span></span><br><span class="line"><span class="language-xml">                            &#125;</span></span><br><span class="line"><span class="language-xml">                        &#125;</span></span><br><span class="line"><span class="language-xml">                    ]</span></span><br><span class="line"><span class="language-xml">                &#125;;</span></span><br><span class="line"><span class="language-xml">                // myChart.setOption(option);</span></span><br><span class="line"><span class="language-xml">                app.currentIndex = -1;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                setInterval(function () &#123;</span></span><br><span class="line"><span class="language-xml">                    var dataLen = option.series[0].data.length;</span></span><br><span class="line"><span class="language-xml">                    // 取消之前高亮的图形</span></span><br><span class="line"><span class="language-xml">                    myChart.dispatchAction(&#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;downplay&#x27;,</span></span><br><span class="line"><span class="language-xml">                        seriesIndex: 0,</span></span><br><span class="line"><span class="language-xml">                        dataIndex: app.currentIndex</span></span><br><span class="line"><span class="language-xml">                    &#125;);</span></span><br><span class="line"><span class="language-xml">                    app.currentIndex = (app.currentIndex + 1) % dataLen;</span></span><br><span class="line"><span class="language-xml">                    // 高亮当前图形</span></span><br><span class="line"><span class="language-xml">                    myChart.dispatchAction(&#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;highlight&#x27;,</span></span><br><span class="line"><span class="language-xml">                        seriesIndex: 0,</span></span><br><span class="line"><span class="language-xml">                        dataIndex: app.currentIndex</span></span><br><span class="line"><span class="language-xml">                    &#125;);</span></span><br><span class="line"><span class="language-xml">                    // 显示 tooltip</span></span><br><span class="line"><span class="language-xml">                    myChart.dispatchAction(&#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;showTip&#x27;,</span></span><br><span class="line"><span class="language-xml">                        seriesIndex: 0,</span></span><br><span class="line"><span class="language-xml">                        dataIndex: app.currentIndex</span></span><br><span class="line"><span class="language-xml">                    &#125;);</span></span><br><span class="line"><span class="language-xml">                &#125;, 1000);</span></span><br><span class="line"><span class="language-xml">                if (option &amp;&amp; typeof option === &quot;object&quot;) &#123;</span></span><br><span class="line"><span class="language-xml">                    myChart.setOption(option, true);</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">                ;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml">$scope.line = function () &#123;</span></span><br><span class="line"><span class="language-xml">    $scope.searchng = false;</span></span><br><span class="line"><span class="language-xml">    $scope.displayng = false;</span></span><br><span class="line"><span class="language-xml">    $scope.pictureng = true;</span></span><br><span class="line"><span class="language-xml">    $http.get(&quot;/news/line&quot;).then(</span></span><br><span class="line"><span class="language-xml">        function (res) &#123;</span></span><br><span class="line"><span class="language-xml">            if(res.data.message==&#x27;url&#x27;)&#123;</span></span><br><span class="line"><span class="language-xml">                window.location.href=res.data.result;</span></span><br><span class="line"><span class="language-xml">            &#125;else &#123;</span></span><br><span class="line"><span class="language-xml">                var myChart = echarts.init(document.getElementById(&quot;main1&quot;));</span></span><br><span class="line"><span class="language-xml">                </span></span><br><span class="line"><span class="language-xml">                option = &#123;</span></span><br><span class="line"><span class="language-xml">                    title: &#123;</span></span><br><span class="line"><span class="language-xml">                        text: &#x27;&quot;中国&quot;该词在新闻中的出现次数随时间变化图&#x27;</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    xAxis: &#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;category&#x27;,</span></span><br><span class="line"><span class="language-xml">                        data: Object.keys(res.data.result)</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    yAxis: &#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;value&#x27;</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    series: [&#123;</span></span><br><span class="line"><span class="language-xml">                        data: Object.values(res.data.result),</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;line&#x27;,</span></span><br><span class="line"><span class="language-xml">                        smooth: true,</span></span><br><span class="line"><span class="language-xml">                        itemStyle: &#123;normal: &#123;label: &#123;show: true&#125;&#125;&#125;</span></span><br><span class="line"><span class="language-xml">                    &#125;],</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                &#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                if (option &amp;&amp; typeof option === &quot;object&quot;) &#123;</span></span><br><span class="line"><span class="language-xml">                    myChart.setOption(option, true);</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">&#125;;</span></span><br><span class="line"><span class="language-xml">$scope.wordcloud = function () &#123;</span></span><br><span class="line"><span class="language-xml">    $scope.searchng = false;</span></span><br><span class="line"><span class="language-xml">    $scope.displayng = false;</span></span><br><span class="line"><span class="language-xml">    $scope.pictureng = true;</span></span><br><span class="line"><span class="language-xml">    $http.get(&quot;/news/wordcloud&quot;).then(</span></span><br><span class="line"><span class="language-xml">        function (res) &#123;</span></span><br><span class="line"><span class="language-xml">            if(res.data.message==&#x27;url&#x27;)&#123;</span></span><br><span class="line"><span class="language-xml">                window.location.href=res.data.result;</span></span><br><span class="line"><span class="language-xml">            &#125;else &#123;</span></span><br><span class="line"><span class="language-xml">                var mainContainer = document.getElementById(&#x27;main1&#x27;);</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                var chart = echarts.init(mainContainer);</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                var data = [];</span></span><br><span class="line"><span class="language-xml">                for (var name in res.data.result) &#123;</span></span><br><span class="line"><span class="language-xml">                    data.push(&#123;</span></span><br><span class="line"><span class="language-xml">                        name: name,</span></span><br><span class="line"><span class="language-xml">                        value: Math.sqrt(res.data.result[name])</span></span><br><span class="line"><span class="language-xml">                    &#125;)</span></span><br><span class="line"><span class="language-xml">                &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                var maskImage = new Image();</span></span><br><span class="line"><span class="language-xml">                maskImage.src = &#x27;./images/logo.png&#x27;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                var option = &#123;</span></span><br><span class="line"><span class="language-xml">                    title: &#123;</span></span><br><span class="line"><span class="language-xml">                        text: &#x27;所有新闻内容 jieba分词 的词云展示&#x27;</span></span><br><span class="line"><span class="language-xml">                    &#125;,</span></span><br><span class="line"><span class="language-xml">                    series: [&#123;</span></span><br><span class="line"><span class="language-xml">                        type: &#x27;wordCloud&#x27;,</span></span><br><span class="line"><span class="language-xml">                        sizeRange: [12, 60],</span></span><br><span class="line"><span class="language-xml">                        rotationRange: [-90, 90],</span></span><br><span class="line"><span class="language-xml">                        rotationStep: 45,</span></span><br><span class="line"><span class="language-xml">                        gridSize: 2,</span></span><br><span class="line"><span class="language-xml">                        shape: &#x27;circle&#x27;,</span></span><br><span class="line"><span class="language-xml">                        maskImage: maskImage,</span></span><br><span class="line"><span class="language-xml">                        drawOutOfBound: false,</span></span><br><span class="line"><span class="language-xml">                        textStyle: &#123;</span></span><br><span class="line"><span class="language-xml">                            normal: &#123;</span></span><br><span class="line"><span class="language-xml">                                fontFamily: &#x27;sans-serif&#x27;,</span></span><br><span class="line"><span class="language-xml">                                fontWeight: &#x27;bold&#x27;,</span></span><br><span class="line"><span class="language-xml">                                // Color can be a callback function or a color string</span></span><br><span class="line"><span class="language-xml">                                color: function () &#123;</span></span><br><span class="line"><span class="language-xml">                                    // Random color</span></span><br><span class="line"><span class="language-xml">                                    return &#x27;rgb(&#x27; + [</span></span><br><span class="line"><span class="language-xml">                                        Math.round(Math.random() * 160),</span></span><br><span class="line"><span class="language-xml">                                        Math.round(Math.random() * 160),</span></span><br><span class="line"><span class="language-xml">                                        Math.round(Math.random() * 160)</span></span><br><span class="line"><span class="language-xml">                                    ].join(&#x27;,&#x27;) + &#x27;)&#x27;;</span></span><br><span class="line"><span class="language-xml">                                &#125;</span></span><br><span class="line"><span class="language-xml">                            &#125;,</span></span><br><span class="line"><span class="language-xml">                            emphasis: &#123;</span></span><br><span class="line"><span class="language-xml">                                shadowBlur: 10,</span></span><br><span class="line"><span class="language-xml">                                shadowColor: &#x27;#333&#x27;</span></span><br><span class="line"><span class="language-xml">                            &#125;</span></span><br><span class="line"><span class="language-xml">                        &#125;,</span></span><br><span class="line"><span class="language-xml">                        data: data</span></span><br><span class="line"><span class="language-xml">                    &#125;]</span></span><br><span class="line"><span class="language-xml">                &#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                maskImage.onload = function () &#123;</span></span><br><span class="line"><span class="language-xml">                    // option.series[0].data = data;</span></span><br><span class="line"><span class="language-xml">                    chart.clear();</span></span><br><span class="line"><span class="language-xml">                    chart.setOption(option);</span></span><br><span class="line"><span class="language-xml">                &#125;;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">                window.onresize = function () &#123;</span></span><br><span class="line"><span class="language-xml">                    chart.resize();</span></span><br><span class="line"><span class="language-xml">                &#125;;</span></span><br><span class="line"><span class="language-xml">            &#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        &#125;);</span></span><br><span class="line"><span class="language-xml">&#125;</span></span><br></pre></td></tr></table></figure><h2 id="管理界面"><a href="#管理界面" class="headerlink" title="管理界面"></a>管理界面</h2><p>实现了一个简易的网站管理端，可以手动添加用户，停用或者启用某一用户，查看某一用户的登入登出记录</p><p><img src="https://i.loli.net/2021/06/30/C6WIUpamLEc2Pdw.png" alt="Snipaste_2021-06-30_16-18-56.png"></p><p><img src="https://i.loli.net/2021/06/30/phSqR6Y4L2mBWOQ.png" alt="Snipaste_2021-06-30_16-19-49.png"></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用户管理功能</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/stopuser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(req.query.id);</span></span><br><span class="line">    <span class="keyword">const</span> sqlStr = <span class="string">&quot;update user set valid=0 where id=?&quot;</span>;</span><br><span class="line">    db.<span class="title function_">query</span>(sqlStr, [req.<span class="property">query</span>.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> &#123; <span class="string">&quot;status&quot;</span>: <span class="number">500</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;停用用户失败失败！&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新数据成功!&#x27;</span>)&#125;;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;status&quot;</span>: <span class="number">200</span>,<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;停用用户成功！&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/startuser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(req.query.id);</span></span><br><span class="line">    <span class="keyword">const</span> sqlStr = <span class="string">&quot;update user set valid=1 where id=?&quot;</span>;</span><br><span class="line">    db.<span class="title function_">query</span>(sqlStr, [req.<span class="property">query</span>.<span class="property">id</span>], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> &#123; <span class="string">&quot;status&quot;</span>: <span class="number">500</span>, <span class="string">&quot;msg&quot;</span>: <span class="string">&quot;启用用户失败！&quot;</span>&#125;;</span><br><span class="line">        <span class="keyword">if</span> (results.<span class="property">affectedRows</span> === <span class="number">1</span>) &#123;</span><br><span class="line">            &#123;<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;更新数据成功!&#x27;</span>)&#125;;</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;status&quot;</span>: <span class="number">200</span>,<span class="string">&quot;msg&quot;</span>: <span class="string">&quot;启用用户成功！&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 日志查询功能</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    db.<span class="title function_">query</span>(<span class="string">&#x27;select * from user_action&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err.<span class="property">message</span>);</span><br><span class="line">        res.<span class="title function_">send</span>(result);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>以上就是本次添加的新功能。</p>]]></content>
      
      
      <categories>
          
          <category> Web编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 前端 </tag>
            
            <tag> 后端 </tag>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> Angular </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js实现爬虫和后端查询数据库</title>
      <link href="/posts/3832ff9/"/>
      <url>/posts/3832ff9/</url>
      
        <content type="html"><![CDATA[<p>使用Node.js实现了一个爬虫，爬取新闻并将结果放入MySQL数据库中，最后使用Node.js的Express框架搭建一个小网站对新闻进行展示。</p><span id="more"></span><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>这是一个大三才学Web编程的苦逼数据专业中下游学生的期中作业，大概用Node.js写了一个小爬虫，然后用Node.js搭建了一个可以查询数据库的后端。</p><h2 id="分析种子网站"><a href="#分析种子网站" class="headerlink" title="分析种子网站"></a>分析种子网站</h2><p>第一个目标是腾讯新闻，打开腾讯新闻的网站：<a href="https://www.qq.com/">腾讯首页 (qq.com)</a></p><p><img src="https://i.loli.net/2021/04/29/LgrEobdlmc8vI6Y.png" alt="Snipaste_2021-04-29_08-58-21.png"></p><p>查看其源代码发现文章的url格式为</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://new.qq.com/omn/20210428/20210428A05F5600.html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/04/29/cJWwBaAsbjCvXG6.png" alt="Snipaste_2021-04-29_09-00-55.png"></p><p>则对应的正则表达式为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url_reg = <span class="regexp">/omn\/(\d&#123;8&#125;)\/([A-Z0-9]&#123;16&#125;).html/</span>;</span><br></pre></td></tr></table></figure><h2 id="分析新闻页面"><a href="#分析新闻页面" class="headerlink" title="分析新闻页面"></a>分析新闻页面</h2><p>对于其中一篇文章，查看其源代码，发现我们需要的几个属性分别对应的标签如下</p><p><img src="https://i.loli.net/2021/04/29/B7NAEVhTGYWxJdR.png" alt="Snipaste_2021-04-29_09-03-35.png"></p><p><img src="https://i.loli.net/2021/04/29/N7jdluSH2gmDaOF.png" alt="Snipaste_2021-04-29_09-05-48.png"></p><p>则代码如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> keywords_format = <span class="string">&quot; $(&#x27;meta[name=\&quot;keywords\&quot;]&#x27;).eq(0).attr(\&quot;content\&quot;)&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> title_format = <span class="string">&quot;$(&#x27;title&#x27;).text()&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> date_format = <span class="string">&quot; $(&#x27;meta[name=\&quot;apub:time\&quot;]&#x27;).eq(0).attr(\&quot;content\&quot;)&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> author_format = <span class="string">&quot;&quot;</span>;<span class="comment">//腾讯的新闻页面没有作者或者编辑相关字段</span></span><br><span class="line"><span class="keyword">var</span> content_format = <span class="string">&quot;$(&#x27;.one-p&#x27;).text()&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> desc_format = <span class="string">&quot; $(&#x27;meta[name=\&quot;description\&quot;]&#x27;).eq(0).attr(\&quot;content\&quot;)&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> source_format = <span class="string">&quot;&quot;</span>;<span class="comment">//腾讯的新闻页面没有source相关字段</span></span><br></pre></td></tr></table></figure><h2 id="编写爬虫代码"><a href="#编写爬虫代码" class="headerlink" title="编写爬虫代码"></a>编写爬虫代码</h2><p>导入需要使用的包，其中mysql.js是另外一个用于连接mysql的文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> myRequest = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> myCheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> myIconv = <span class="built_in">require</span>(<span class="string">&#x27;iconv-lite&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;./mysql.js&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;date-utils&#x27;</span>);</span><br></pre></td></tr></table></figure><p>一些变量的设置</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//防止网站屏蔽我们的爬虫</span></span><br><span class="line"><span class="keyword">var</span> headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.1 (KHTML, like Gecko) Chrome/14.0.835.163 Safari/535.1&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//request模块异步fetch url</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">request</span>(<span class="params">url, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> options = &#123;</span><br><span class="line">        <span class="attr">url</span>: url,</span><br><span class="line">        <span class="attr">encoding</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="comment">//proxy: &#x27;http://x.x.x.x:8080&#x27;,</span></span><br><span class="line">        <span class="attr">headers</span>: headers,</span><br><span class="line">        <span class="attr">timeout</span>: <span class="number">10000</span> <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">myRequest</span>(options, callback)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中请求头(headers)使用的Windows下的Chrome，然后定义request函数用于获取种子网页(html)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">request</span>(seedURL, <span class="keyword">function</span>(<span class="params">err, res, body</span>) &#123; <span class="comment">//读取种子页面</span></span><br><span class="line">    <span class="comment">// try &#123;</span></span><br><span class="line">    <span class="comment">//用iconv转换编码</span></span><br><span class="line">    <span class="keyword">var</span> html = myIconv.<span class="title function_">decode</span>(body, myEncoding);</span><br><span class="line">    <span class="comment">//console.log(html);</span></span><br><span class="line">    <span class="comment">//准备用cheerio解析html</span></span><br><span class="line">    <span class="keyword">var</span> $ = myCheerio.<span class="title function_">load</span>(html, &#123; <span class="attr">decodeEntities</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">    <span class="comment">// &#125; catch (e) &#123; console.log(&#x27;读种子页面并转码出错：&#x27; + e) &#125;;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> seedurl_news;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        seedurl_news = <span class="built_in">eval</span>(seedURL_format);</span><br><span class="line">        <span class="comment">//console.log(seedurl_news);</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;url列表所处的html块识别出错：&#x27;</span> + e) &#125;;</span><br><span class="line"></span><br><span class="line">    seedurl_news.<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">i, e</span>) &#123; <span class="comment">//遍历种子页面里所有的a链接</span></span><br><span class="line">        <span class="keyword">var</span> myURL = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//得到具体新闻url</span></span><br><span class="line">            <span class="keyword">var</span> href = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            href = $(e).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_">typeof</span>(href) == <span class="string">&quot;undefined&quot;</span>) &#123;  <span class="comment">// 有些网页地址undefined</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (href.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;http://&#x27;</span>) &gt;= <span class="number">0</span> || href.<span class="title function_">toLowerCase</span>().<span class="title function_">indexOf</span>(<span class="string">&#x27;https://&#x27;</span>) &gt;= <span class="number">0</span>) myURL = href; <span class="comment">//http://开头的或者https://开头</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (href.<span class="title function_">startsWith</span>(<span class="string">&#x27;//&#x27;</span>)) myURL = <span class="string">&#x27;http:&#x27;</span> + href; <span class="comment">////开头的</span></span><br><span class="line">            <span class="keyword">else</span> myURL = seedURL.<span class="title function_">substr</span>(<span class="number">0</span>, seedURL.<span class="title function_">lastIndexOf</span>(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>) + href; <span class="comment">//其他</span></span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;识别种子页面中的新闻链接出错：&#x27;</span> + e) &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!url_reg.<span class="title function_">test</span>(myURL)) <span class="keyword">return</span>; <span class="comment">//检验是否符合新闻url的正则表达式</span></span><br><span class="line">        <span class="comment">// console.log(myURL);</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> fetch_url_Sql = <span class="string">&#x27;select url from fetches where url=?&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> fetch_url_Sql_Params = [myURL];</span><br><span class="line">        mysql.<span class="title function_">query</span>(fetch_url_Sql, fetch_url_Sql_Params, <span class="keyword">function</span>(<span class="params">qerr, vals, fields</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (vals.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;URL duplicate!&#x27;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="title function_">newsGet</span>(myURL); <span class="comment">//读取新闻页面</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>大概逻辑为获取到种子网站后，遍历其中的所有的a标签，如果符合我们定义的新闻文章链接的正则表达式并且没有爬取过（即该url不存在数据库中），则调用newsGet函数获取文章内容，不符合或者已存在则查看下一个a标签</p><p>newsGet函数如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">newsGet</span>(<span class="params">myURL</span>) &#123; <span class="comment">//读取新闻页面</span></span><br><span class="line">    <span class="title function_">request</span>(myURL, <span class="keyword">function</span>(<span class="params">err, res, body</span>) &#123; <span class="comment">//读取新闻页面</span></span><br><span class="line">        <span class="comment">//try &#123;</span></span><br><span class="line">        <span class="keyword">var</span> html_news = myIconv.<span class="title function_">decode</span>(body, myEncoding); <span class="comment">//用iconv转换编码</span></span><br><span class="line">        <span class="comment">//console.log(html_news);</span></span><br><span class="line">        <span class="comment">//准备用cheerio解析html_news</span></span><br><span class="line">        <span class="keyword">var</span> $ = myCheerio.<span class="title function_">load</span>(html_news, &#123; <span class="attr">decodeEntities</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">        myhtml = html_news;</span><br><span class="line">        <span class="comment">//&#125; catch (e) &#123;    console.log(&#x27;读新闻页面并转码出错：&#x27; + e);&#125;;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;转码读取成功:&quot;</span> + myURL);</span><br><span class="line">        <span class="comment">//动态执行format字符串，构建json对象准备写入文件或数据库</span></span><br><span class="line">        <span class="keyword">var</span> fetch = &#123;&#125;;</span><br><span class="line">        fetch.<span class="property">title</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        fetch.<span class="property">content</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        fetch.<span class="property">publish_date</span> = (<span class="keyword">new</span> <span class="title class_">Date</span>()).<span class="title function_">toFormat</span>(<span class="string">&quot;YYYY-MM-DD&quot;</span>);</span><br><span class="line">        <span class="comment">//fetch.html = myhtml;</span></span><br><span class="line">        fetch.<span class="property">url</span> = myURL;</span><br><span class="line">        fetch.<span class="property">source_name</span> = source_name;</span><br><span class="line">        fetch.<span class="property">source_encoding</span> = myEncoding; <span class="comment">//编码</span></span><br><span class="line">        fetch.<span class="property">crawltime</span> = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (keywords_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">keywords</span> = source_name; <span class="comment">// eval(keywords_format);  //没有关键词就用sourcename</span></span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">keywords</span> = <span class="built_in">eval</span>(keywords_format);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (title_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">title</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">title</span> = <span class="built_in">eval</span>(title_format); <span class="comment">//标题</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (date_format != <span class="string">&quot;&quot;</span>) fetch.<span class="property">publish_date</span> = <span class="built_in">eval</span>(date_format); <span class="comment">//刊登日期   </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;date: &#x27;</span> + fetch.<span class="property">publish_date</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(myURL);</span><br><span class="line">        <span class="keyword">if</span> (fetch.<span class="property">title</span> == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;此文章不存在&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        fetch.<span class="property">publish_date</span> = regExp.<span class="title function_">exec</span>(fetch.<span class="property">publish_date</span>)[<span class="number">0</span>];</span><br><span class="line">        fetch.<span class="property">publish_date</span> = fetch.<span class="property">publish_date</span>.<span class="title function_">replace</span>(<span class="string">&#x27;年&#x27;</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        fetch.<span class="property">publish_date</span> = fetch.<span class="property">publish_date</span>.<span class="title function_">replace</span>(<span class="string">&#x27;月&#x27;</span>, <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">        fetch.<span class="property">publish_date</span> = fetch.<span class="property">publish_date</span>.<span class="title function_">replace</span>(<span class="string">&#x27;日&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        fetch.<span class="property">publish_date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>(fetch.<span class="property">publish_date</span>).<span class="title function_">toFormat</span>(<span class="string">&quot;YYYY-MM-DD&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (author_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">author</span> = source_name; <span class="comment">//eval(author_format);  //作者</span></span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">author</span> = <span class="built_in">eval</span>(author_format);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (content_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">content</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">content</span> = <span class="built_in">eval</span>(content_format).<span class="title function_">replace</span>(<span class="string">&quot;\r\n&quot;</span> + fetch.<span class="property">author</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//内容,是否要去掉作者信息自行决定</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (source_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">source</span> = fetch.<span class="property">source_name</span>;</span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">source</span> = <span class="built_in">eval</span>(source_format).<span class="title function_">replace</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//来源</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (desc_format == <span class="string">&quot;&quot;</span>) fetch.<span class="property">desc</span> = fetch.<span class="property">title</span>;</span><br><span class="line">        <span class="keyword">else</span> fetch.<span class="property">desc</span> = <span class="built_in">eval</span>(desc_format).<span class="title function_">replace</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;&quot;</span>); <span class="comment">//摘要    </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> fetchAddSql = <span class="string">&#x27;INSERT INTO fetches(url,source_name,source_encoding,title,&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;keywords,author,publish_date,crawltime,content) VALUES(?,?,?,?,?,?,?,?,?)&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> fetchAddSql_Params = [fetch.<span class="property">url</span>, fetch.<span class="property">source_name</span>, fetch.<span class="property">source_encoding</span>,</span><br><span class="line">            fetch.<span class="property">title</span>, fetch.<span class="property">keywords</span>, fetch.<span class="property">author</span>, fetch.<span class="property">publish_date</span>,</span><br><span class="line">            fetch.<span class="property">crawltime</span>.<span class="title function_">toFormat</span>(<span class="string">&quot;YYYY-MM-DD HH24:MI:SS&quot;</span>), fetch.<span class="property">content</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行sql，数据库中fetch表里的url属性是unique的，不会把重复的url内容写入数据库</span></span><br><span class="line">        mysql.<span class="title function_">query</span>(fetchAddSql, fetchAddSql_Params, <span class="keyword">function</span>(<span class="params">qerr, vals, fields</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (qerr) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(qerr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;); <span class="comment">//mysql写入</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是爬虫的最重要的函数，用于读取解析一篇新闻，一些字段我们在开头定义了，用于获取文章标题发布日期等信息，其中日期的正则表达式为</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regExp = <span class="regexp">/\d&#123;1,2&#125;\/\d&#123;1,2&#125;\/\d&#123;4&#125;/</span></span><br></pre></td></tr></table></figure><p>因为观察到腾讯新闻的日期格式为</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apub:time&quot;</span> <span class="attr">content</span>=<span class="string">&quot;4/28/2021, 10:51:31 PM&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最后是写入mysql数据库，fetches表结构为</p><table><thead><tr><th>Field</th><th>Type</th><th>Null</th><th>Key</th><th>Default</th><th>Extra</th></tr></thead><tbody><tr><td>id_fetches</td><td>int</td><td>NO</td><td>PRI</td><td>NULL</td><td>auto_increment</td></tr><tr><td>url</td><td>varchar(200)</td><td>YES</td><td>UNI</td><td>NULL</td><td></td></tr><tr><td>source_name</td><td>varchar(200)</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>source_encoding</td><td>varchar(45)</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>title</td><td>varchar(200)</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>keywords</td><td>varchar(200)</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>author</td><td>varchar(200)</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>publish_date</td><td>date</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>crawltime</td><td>datetime</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>content</td><td>longtext</td><td>YES</td><td></td><td>NULL</td><td></td></tr><tr><td>createtime</td><td>datetime</td><td>YES</td><td></td><td>CURRENT_TIMESTAMP</td><td>DEFAULT_GENERATED</td></tr></tbody></table><p>至此，爬虫部分结束，后续还爬取了一些其他新闻网站，并且其他新闻网站的页面大多比腾讯新闻更加简单，这里不再展示。</p><h2 id="搭建查询Web服务器"><a href="#搭建查询Web服务器" class="headerlink" title="搭建查询Web服务器"></a>搭建查询Web服务器</h2><p>这里采用Node.js的express框架，首先在Node.js中安装express包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在终端中执行</span></span><br><span class="line">npm install express</span><br><span class="line">npm install -g express-generator</span><br></pre></td></tr></table></figure><p>安装完成后在目标文件夹下执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">express -e search_site# -e的参数表明我们用ejs作为缺省view引擎，而非采用jade</span><br></pre></td></tr></table></figure><p>会生成一个名为search_site的文件夹，目录结构如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">C:.</span><br><span class="line">│  app.js</span><br><span class="line">│  package.json</span><br><span class="line">│</span><br><span class="line">├─bin</span><br><span class="line">│      www</span><br><span class="line">│</span><br><span class="line">├─public</span><br><span class="line">│  ├─images</span><br><span class="line">│  ├─javascripts</span><br><span class="line">│  └─stylesheets</span><br><span class="line">│          style.css</span><br><span class="line">│</span><br><span class="line">├─routes</span><br><span class="line">│      index.js</span><br><span class="line">│      users.js</span><br><span class="line">│</span><br><span class="line">└─views</span><br><span class="line">        error.ejs</span><br><span class="line">        index.ejs</span><br></pre></td></tr></table></figure><p>把我们在爬虫中使用的mysql.js拷贝进该文件夹，然后在search_site文件夹中执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install mysql --save</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--save表示将mysql包安装到该项目中，并且将依赖项保存进package.json里</span></span><br><span class="line">npm install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将package.json中列举的依赖项全部安装，完成网站搭建</span></span><br></pre></td></tr></table></figure><p>package.json内容如下，包含了此项目必要的包</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;search-site&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;private&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node ./bin/www&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;cookie-parser&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~1.4.4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;debug&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~2.6.9&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;ejs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~2.6.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;express&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~4.16.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;http-errors&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~1.6.3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;morgan&quot;</span><span class="punctuation">:</span> <span class="string">&quot;~1.9.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mysql&quot;</span><span class="punctuation">:</span> <span class="string">&quot;^2.18.1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>为了实现功能，我们先去修改路由（routes）。</p><p>打开routes文件夹中的index.js，修改后如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;../mysql.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;Express&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新添加了一个路由，用做查询数据库并返回查询结果</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/process_get&#x27;</span>, <span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    <span class="comment">//sql字符串和参数</span></span><br><span class="line">    <span class="keyword">var</span> fetchSql = <span class="string">&quot;select url,source_name,title,author,publish_date &quot;</span> +</span><br><span class="line">        <span class="string">&quot;from fetches where title like &#x27;%&quot;</span> + request.<span class="property">query</span>.<span class="property">title</span> + <span class="string">&quot;%&#x27;&quot;</span>;</span><br><span class="line">    mysql.<span class="title function_">query</span>(fetchSql, <span class="keyword">function</span>(<span class="params">err, result, fields</span>) &#123;</span><br><span class="line">        response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        response.<span class="title function_">write</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">        response.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>还需要一个用于展示的网页，在public文件夹下编写search.html</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span> 标题：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title_text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cardLayout&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 10px 0px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">id</span>=<span class="string">&quot;record2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">         $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;input:button&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">get</span>(<span class="string">&#x27;/process_get?title=&#x27;</span> + $(<span class="string">&quot;input:text&quot;</span>).<span class="title function_">val</span>(), <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">empty</span>();</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;url&lt;/td&gt;&lt;td&gt;source_name&lt;/td&gt;&#x27;</span> +</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;&lt;td&gt;title&lt;/td&gt;&lt;td&gt;author&lt;/td&gt;&lt;td&gt;publish_date&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">for</span> (<span class="keyword">let</span> list <span class="keyword">of</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> table = <span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">Object</span>.<span class="title function_">values</span>(list).<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                            table += (element + <span class="string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">append</span>(table + <span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最后在search_site文件夹下运行如下命令开启本地服务器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node bin/www</span><br></pre></td></tr></table></figure><p>访问</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:3000/search.html</span><br></pre></td></tr></table></figure><p>可以看到查询的页面如下</p><p><img src="https://i.loli.net/2021/04/30/bh6ytsJwSNLzcDx.png" alt="Snipaste_2021-04-30_10-52-02.png"></p><p>在输入框中输入想要查询的标题，下面就会以表格的形式进行展示</p><p><img src="https://i.loli.net/2021/04/30/y95EY6h7XIDdBaG.png" alt="Snipaste_2021-04-30_10-53-57.png"></p><p>继续在路由中添加一个可以统计搜索文章的时间热度，即某天包含某关键词的文章发表了多少篇。</p><p>继续修改routes&#x2F;index.js文件，修改后如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;../mysql.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res, next</span>) &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;Express&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新添加了一个路由，用做查询数据库并返回查询结果</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/process_get&#x27;</span>, <span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    <span class="comment">//sql字符串和参数</span></span><br><span class="line">    <span class="keyword">var</span> fetchSql = <span class="string">&quot;select url,source_name,title,author,publish_date &quot;</span> +</span><br><span class="line">        <span class="string">&quot;from fetches where title like &#x27;%&quot;</span> + request.<span class="property">query</span>.<span class="property">title</span> + <span class="string">&quot;%&#x27;&quot;</span>;</span><br><span class="line">    mysql.<span class="title function_">query</span>(fetchSql, <span class="keyword">function</span>(<span class="params">err, result, fields</span>) &#123;</span><br><span class="line">        response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        response.<span class="title function_">write</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">        response.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 搜索发表时间并且按照时间聚类，统计数量</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/time_get&#x27;</span>, <span class="keyword">function</span>(<span class="params">request, response</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> fetchSql = <span class="string">&quot;SELECT publish_date, COUNT(title) FROM fetches WHERE title LIKE &#x27;%&quot;</span>+ </span><br><span class="line">    request.<span class="property">query</span>.<span class="property">title</span> +<span class="string">&quot;%&#x27; GROUP BY publish_date;&quot;</span>;</span><br><span class="line">    mysql.<span class="title function_">query</span>(fetchSql, <span class="keyword">function</span>(<span class="params">err, result, fields</span>) &#123;</span><br><span class="line">        response.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">            <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span></span><br><span class="line">        &#125;);</span><br><span class="line">        response.<span class="title function_">write</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">        response.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><p>相应的，为了展示搜索结果，我们也需要修改public&#x2F;search.html，修改后如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span> 标题：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title_text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;form-submit&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;查询&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cardLayout&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 10px 0px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">id</span>=<span class="string">&quot;record1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;input:button&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">get</span>(<span class="string">&#x27;/time_get?title=&#x27;</span> + $(<span class="string">&quot;input:text&quot;</span>).<span class="title function_">val</span>(), <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">empty</span>();</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;publish_date&lt;/td&gt;&lt;td&gt;count&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">for</span> (<span class="keyword">let</span> list <span class="keyword">of</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> regExp = <span class="regexp">/((\d&#123;4&#125;|\d&#123;2&#125;)(\-|\/|\.)\d&#123;1,2&#125;\3\d&#123;1,2&#125;)/</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> table = <span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">Object</span>.<span class="title function_">values</span>(list).<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">if</span> (regExp.<span class="title function_">test</span>(element)) element = regExp.<span class="title function_">exec</span>(element)[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">                            table += (element + <span class="string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">append</span>(table + <span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;cardLayout&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin: 10px 0px&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">id</span>=<span class="string">&quot;record2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">         $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;input:button&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $.<span class="title function_">get</span>(<span class="string">&#x27;/process_get?title=&#x27;</span> + $(<span class="string">&quot;input:text&quot;</span>).<span class="title function_">val</span>(), <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">empty</span>();</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;url&lt;/td&gt;&lt;td&gt;source_name&lt;/td&gt;&#x27;</span> +</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;&lt;td&gt;title&lt;/td&gt;&lt;td&gt;author&lt;/td&gt;&lt;td&gt;publish_date&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">for</span> (<span class="keyword">let</span> list <span class="keyword">of</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> regExp = <span class="regexp">/((\d&#123;4&#125;|\d&#123;2&#125;)(\-|\/|\.)\d&#123;1,2&#125;\3\d&#123;1,2&#125;)/</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">let</span> table = <span class="string">&#x27;&lt;tr class=&quot;cardLayout&quot;&gt;&lt;td&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="title class_">Object</span>.<span class="title function_">values</span>(list).<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="keyword">if</span> (regExp.<span class="title function_">test</span>(element)) element = regExp.<span class="title function_">exec</span>(element)[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">                            table += (element + <span class="string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                        &#125;);</span></span><br><span class="line"><span class="language-javascript">                        $(<span class="string">&quot;#record2&quot;</span>).<span class="title function_">append</span>(table + <span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中新添加了一个表格，用于展示时间热度。</p><p>最后按照上面的流程访问更新后的网站，查询效果如下</p><p><img src="https://i.loli.net/2021/04/30/6YdOQsGDbPXeVhy.png" alt="Snipaste_2021-04-30_11-02-35.png"></p><p>基本功能已经实现，下面是对展示效果进行优化，在search.html中加入css</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">    <span class="selector-tag">input</span><span class="selector-attr">[type=text]</span>, <span class="selector-tag">select</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">12px</span> <span class="number">20px</span>;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">display</span>: inline-block;</span><br><span class="line">      <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">      <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-tag">input</span><span class="selector-attr">[type=button]</span> &#123;</span><br><span class="line">      <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#98bf21</span>;</span><br><span class="line">      <span class="attribute">color</span>: white;</span><br><span class="line">      <span class="attribute">padding</span>: <span class="number">14px</span> <span class="number">20px</span>;</span><br><span class="line">      <span class="attribute">margin</span>: <span class="number">8px</span> <span class="number">0</span>;</span><br><span class="line">      <span class="attribute">border</span>: none;</span><br><span class="line">      <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span><br><span class="line">      <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="selector-tag">input</span><span class="selector-attr">[type=button]</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">      <span class="attribute">background-color</span>: <span class="number">#98bf21</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record2</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">border-collapse</span>:collapse;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record2</span> <span class="selector-tag">td</span>, <span class="selector-id">#record2</span> <span class="selector-tag">th</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">1em</span>;</span><br><span class="line">        <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#98bf21</span>;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">3px</span> <span class="number">7px</span> <span class="number">2px</span> <span class="number">7px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record2</span> <span class="selector-tag">th</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">1.1em</span>;</span><br><span class="line">        <span class="attribute">text-align</span><span class="selector-pseudo">:left</span>;</span><br><span class="line">        <span class="attribute">padding-top</span>:<span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">padding-bottom</span>:<span class="number">4px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="number">#A7C942</span>;</span><br><span class="line">        <span class="attribute">color</span>:<span class="number">#ffffff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record2</span> <span class="selector-tag">tr</span><span class="selector-class">.alt</span> <span class="selector-tag">td</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">color</span>:<span class="number">#000000</span>;</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="number">#EAF2D3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record1</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">        <span class="attribute">border-collapse</span>:collapse;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record1</span> <span class="selector-tag">td</span>, <span class="selector-id">#record2</span> <span class="selector-tag">th</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">1em</span>;</span><br><span class="line">        <span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#98bf21</span>;</span><br><span class="line">        <span class="attribute">padding</span>:<span class="number">3px</span> <span class="number">7px</span> <span class="number">2px</span> <span class="number">7px</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record1</span> <span class="selector-tag">th</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">font-size</span>:<span class="number">1.1em</span>;</span><br><span class="line">        <span class="attribute">text-align</span><span class="selector-pseudo">:left</span>;</span><br><span class="line">        <span class="attribute">padding-top</span>:<span class="number">5px</span>;</span><br><span class="line">        <span class="attribute">padding-bottom</span>:<span class="number">4px</span>;</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="number">#A7C942</span>;</span><br><span class="line">        <span class="attribute">color</span>:<span class="number">#ffffff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-id">#record1</span> <span class="selector-tag">tr</span><span class="selector-class">.alt</span> <span class="selector-tag">td</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attribute">color</span>:<span class="number">#000000</span>;</span><br><span class="line">        <span class="attribute">background-color</span>:<span class="number">#EAF2D3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p>对按钮（button）和表格进行了修饰</p><p>同时修改了表格后面会多一列的问题</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;input:button&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">get</span>(<span class="string">&#x27;/time_get?title=&#x27;</span> + $(<span class="string">&quot;input:text&quot;</span>).<span class="title function_">val</span>(), <span class="keyword">function</span>(<span class="params">data</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">empty</span>();</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;tr&gt;&lt;th&gt;发布时间&lt;/th&gt;&lt;th&gt;数量&lt;/th&gt;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> i = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span> (<span class="keyword">let</span> list <span class="keyword">of</span> data) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> regExp = <span class="regexp">/((\d&#123;4&#125;|\d&#123;2&#125;)(\-|\/|\.)\d&#123;1,2&#125;\3\d&#123;1,2&#125;)/</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> table = <span class="string">&#x27;&lt;tr class=&quot;alt&quot;&gt;&lt;td&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        table = <span class="string">&#x27;&lt;tr&gt;&lt;td&gt;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title class_">Object</span>.<span class="title function_">values</span>(list).<span class="title function_">forEach</span>(<span class="function"><span class="params">element</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">if</span> (regExp.<span class="title function_">test</span>(element)) element = regExp.<span class="title function_">exec</span>(element)[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript">                        table += (element + <span class="string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    &#125;);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">let</span> out_table = table.<span class="title function_">substring</span>(<span class="number">0</span>, table.<span class="property">length</span> - <span class="number">4</span>) <span class="comment">// 这里减去多于的&lt;td&gt;</span></span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#record1&quot;</span>).<span class="title function_">append</span>(out_table + <span class="string">&#x27;&lt;/tr&gt;&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                    i++;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>最后效果如下</p><p><img src="https://i.loli.net/2021/04/30/JQO8NBHaDU473ZV.png" alt="Snipaste_2021-04-30_13-29-45.png"></p><p>完整代码参见<a href="https://github.com/Sidney233/Node.js_crawler">Sidney233&#x2F;Node.js_crawler: 使用Node.js爬取新闻网页并实现一个简单的网页用于查询爬取数据 (github.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> Web编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据库 </tag>
            
            <tag> 前端 </tag>
            
            <tag> 后端 </tag>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
